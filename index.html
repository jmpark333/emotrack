<!DOCTYPE html>
<html>
<head>
    <title>ì •ì„œì  ë…ë¦½ íŠ¸ë˜ì»¤</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --primary: #6C5CE7;
            --secondary: #A29BFE;
            --success: #00B894;
            --warning: #FDCB6E;
            --danger: #FF7675;
            --light: #DFE6E9;
            --dark: #2D3436;
        }
        * { box-sizing: border-box; }
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
            color: var(--dark);
            margin: 0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        .header h1 {
            color: var(--primary);
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }
        .stat-card {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            flex: 1;
            margin: 0 5px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
        }
        .check-item {
            background: var(--light);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 8px;
            transition: all 0.3s;
        }
        .check-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        .check-item.completed {
            background: rgba(0,184,148,0.1);
            border-left: 5px solid var(--success);
        }
        .check-input {
            margin-right: 10px;
            transform: scale(1.3);
        }
        .emergency-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
            margin: 15px 0;
            transition: all 0.3s;
        }
        .emergency-btn:hover {
            background: #e84393;
            transform: scale(1.02);
        }
        .progress-bar {
            height: 8px;
            background: var(--light);
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--warning));
            transition: width 0.5s;
        }
        .diary-section {
            margin: 20px 0;
            padding: 15px;
            background: rgba(108,92,231,0.1);
            border-radius: 15px;
        }
        .diary-input {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            border: 1px solid #ddd;
            font-size: 0.9rem;
        }
        .diary-item {
            background: white;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
            font-size: 0.85rem;
        }
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            margin: 5px 0;
        }
        .btn-danger {
            background: var(--danger);
        }
        .badge {
            display: inline-block;
            background: var(--warning);
            color: var(--dark);
            padding: 3px 10px;
            border-radius: 15px;
            margin: 3px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        /* ëª¨ë°”ì¼ ë·°ë¥¼ ìœ„í•œ ì¶”ê°€ ìŠ¤íƒ€ì¼ */
        body.mobile-view {
            padding: 10px;
        }
        
        body.mobile-view .container {
            padding: 15px;
        }
        
        body.mobile-view .header h1 {
            font-size: 1.5rem;
        }
        
        body.mobile-view .stat-card {
            padding: 12px 8px;
            margin: 0 3px;
        }
        
        body.mobile-view .stat-value {
            font-size: 1.2rem;
        }
        
        body.mobile-view .check-item {
            padding: 10px;
            margin-bottom: 6px;
        }
        
        body.mobile-view .check-input {
            transform: scale(1.2);
        }
        
        body.mobile-view .diary-input {
            font-size: 1rem;
            padding: 10px;
        }
        
        body.mobile-view .btn, body.mobile-view .emergency-btn {
            padding: 12px 15px;
            font-size: 1rem;
        }
        
        body.mobile-view .diary-item {
            font-size: 0.9rem;
            padding: 12px;
        }
        
        /* í™ˆ í™”ë©´ ì•„ì´ì½˜ ì¶”ê°€ë¥¼ ìœ„í•œ ë©”íƒ€ íƒœê·¸ */
        @media (prefers-color-scheme: dark) {
            :root {
                --primary: #8B7CF6;
                --secondary: #A29BFE;
            }
        }
    </style>
    
    <!-- í™ˆ í™”ë©´ì— ì¶”ê°€í•˜ê¸° ìœ„í•œ ì„¤ì • -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ì •ì„œì  ë…ë¦½ íŠ¸ë˜ì»¤">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoi7JeQ7J6QIOyEoOyCrOyKpOyVhOq1rCDrs7XsnLjtirgiLCJzaG9ydF9uYW1lIjoi7JeQ7J6QIOyEoOyCrOyKpOyVhOq1rCIsInN0YXJ0X3VybCI6Ii4iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjZmZmIiwidGhlbWVfY29sb3IiOiIjNkM1Q0U3In0=">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§˜â€â™‚ï¸ ì •ì„œì  ë…ë¦½ íŠ¸ë˜ì»¤</h1>
            <p>ì˜¤ëŠ˜ë„ ë‹¹ì‹ ì˜ í‰ì˜¨í•¨ì„ ì§€í‚¤ëŠ” í•˜ë£¨ê°€ ë˜ê¸¸</p>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="streak">0</div>
                <div>ì—°ì† ì¼ìˆ˜</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="level">1</div>
                <div>í‰ì˜¨ ë ˆë²¨</div>
                <div style="font-size: 0.7rem; margin-top: 5px;" id="levelProgress">ë‹¤ìŒ ë ˆë²¨ê¹Œì§€: 100í¬ì¸íŠ¸</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="points">0</div>
                <div>í‰ì˜¨ í¬ì¸íŠ¸</div>
            </div>
        </div>
        
        <div class="progress-bar">
            <div class="progress" id="dailyProgress" style="width: 0%"></div>
        </div>
        
        <h3>ğŸŒ… ì•„ì¹¨ í›ˆë ¨</h3>
        <div class="check-item">
            <input type="checkbox" class="check-input" id="morning1">
            <label for="morning1">ê°ì • ë¶„ë¦¬ ì„ ì–¸ ("ì˜¤ëŠ˜ ì•„ë‚´ì˜ ê°ì •ì€ ë‚˜ì˜ ê²ƒì´ ì•„ë‹˜" 3ë²ˆ)</label>
        </div>
        <div class="check-item">
            <input type="checkbox" class="check-input" id="morning2">
            <label for="morning2">ì˜¤ëŠ˜ ì§€í‚¬ í•µì‹¬ ê°€ì¹˜ ì„ íƒ (í‰ì˜¨/ì¡´ì¤‘/ìì¡´ê°)</label>
        </div>
        <div class="check-item">
            <input type="checkbox" class="check-input" id="morning3">
            <label for="morning3">ì˜¤ëŠ˜ì˜ 'ë‚˜ë§Œì˜ 30ë¶„' ê³„íš ì„¸ìš°ê¸°</label>
        </div>
        
        <h3>ğŸŒ ì ì‹¬ í›ˆë ¨</h3>
        <div class="check-item">
            <input type="checkbox" class="check-input" id="noon1">
            <label for="noon1">ë¹„íŒì  ë§ ë“¤ì—ˆì„ ë•Œ "ì´ê±´ ì‚¬ì‹¤ì¸ê°€?" í•„í„°ë§</label>
        </div>
        <div class="check-item">
            <input type="checkbox" class="check-input" id="noon2">
            <label for="noon2">"ì§€ê¸ˆì€ ì–´ë µë‹¤"ê³  ë§í•˜ê¸° (ì•„ë‹ˆì˜¤ ì—°ìŠµ)</label>
        </div>
        
        <h3>ğŸŒ™ ì €ë… í›ˆë ¨</h3>
        <div class="check-item">
            <input type="checkbox" class="check-input" id="evening1">
            <label for="evening1">ê°ì • í­ë°œ ì‹œ 4-7-8 í˜¸í¡ë²• 3íšŒ</label>
        </div>
        
        <div class="check-item">
            <label for="evening2">ğŸ“– ê°ì • ì¼ê¸° ì‘ì„±</label>
            <input type="text" id="wifeAction" class="diary-input" placeholder="ì•„ë‚´ì˜ í–‰ë™ (ì˜ˆ: ê³ ì„± ì§ˆë¬¸)">
            <input type="text" id="myReaction" class="diary-input" placeholder="ë‚´ ì²« ë°˜ì‘ (ì˜ˆ: ì£„ì±…ê° + ë¶„ë…¸)">
            <input type="text" id="reinterpretation" class="diary-input" placeholder="ì¬í•´ì„ (ì˜ˆ: ê·¸ë…€ëŠ” ë¶ˆì•ˆí•´ì„œ ê·¸ëŸ° ê±°ì•¼)">
            <button class="btn" onclick="saveDiary()">ğŸ’¾ ì €ì¥í•˜ê³  ì²´í¬ ì™„ë£Œ</button>
        </div>
        
        <div class="check-item">
            <input type="checkbox" class="check-input" id="evening3">
            <label for="evening3">ì˜¤ëŠ˜ ë‚˜ë¥¼ ì§€í‚¨ í–‰ë™ 1ê°€ì§€ ì¹­ì°¬í•˜ê¸°</label>
        </div>
        
        <button class="emergency-btn" onclick="startBreathing()">
            ğŸš¨ ê¸´ê¸‰ í˜¸í¡ë²• ì‹œì‘ (4-7-8)
        </button>
        
        <div class="diary-section">
            <h3>ğŸ“š ìµœê·¼ ê°ì • ì¼ê¸°</h3>
            <div id="diaryList"></div>
            <button class="btn btn-danger" onclick="clearDiaries()">ğŸ—‘ï¸ ëª¨ë“  ì¼ê¸° ì‚­ì œ</button>
        </div>
        
        <div class="reward">
            <h3>ğŸ† ì˜¤ëŠ˜ì˜ ë³´ìƒ</h3>
            <div id="badges"></div>
            <div style="text-align: center; margin: 10px 0;">
                <div style="font-size: 0.9rem; color: #666;">ì˜¤ëŠ˜ íšë“ í¬ì¸íŠ¸</div>
                <div style="font-size: 1.2rem; font-weight: bold; color: var(--primary);" id="dailyPoints">0</div>
            </div>
            <p id="rewardText">ëª¨ë“  ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ì™„ë£Œí•˜ë©´ ë³´ìƒì´ ì—´ë¦½ë‹ˆë‹¤!</p>
        </div>
    </div>

    <script>
        // ë°ì´í„° ì´ˆê¸°í™”
        let userData = JSON.parse(localStorage.getItem('emotionalIndependence')) || {
            streak: 0,
            level: 1,
            points: 0,
            lastCheck: null,
            completedToday: [],
            totalPoints: 0  // ì´ ëˆ„ì  í¬ì¸íŠ¸ ì¶”ê°€
        };
        
        let diaries = JSON.parse(localStorage.getItem('emotionDiaries')) || [];
        
        // ìŠ¤ë§ˆíŠ¸í° í™˜ê²½ ê°ì§€
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        // ìŠ¤ë§ˆíŠ¸í°ì—ì„œì˜ ì‚¬ìš©ì„± ê°œì„ 
        if (isMobile) {
            document.body.classList.add('mobile-view');
        }

        // í™”ë©´ ì—…ë°ì´íŠ¸
        function updateUI() {
            // ì—°ì† ì¼ìˆ˜ í‘œì‹œ
            document.getElementById('streak').textContent = userData.streak;
            document.getElementById('level').textContent = userData.level;
            document.getElementById('points').textContent = userData.points;

            // ë ˆë²¨ ì§„í–‰ë„ í‘œì‹œ ì—…ë°ì´íŠ¸
            updateLevelProgress();

            // ì˜¤ëŠ˜ íšë“ í¬ì¸íŠ¸ í‘œì‹œ
            updateDailyPoints();

            // ì²´í¬ë¦¬ìŠ¤íŠ¸ ìƒíƒœ ë³µì›
            document.querySelectorAll('.check-input').forEach(checkbox => {
                checkbox.checked = userData.completedToday.includes(checkbox.id);
                checkbox.addEventListener('change', handleCheck);
            });

            updateProgress();
            updateBadges();
            displayDiaries();
        }

        // ì²´í¬ ì´ë²¤íŠ¸ ì²˜ë¦¬
        function handleCheck(e) {
            const id = e.target.id;
            const parent = e.target.parentElement;
            
            if(e.target.checked) {
                if(!userData.completedToday.includes(id)) {
                    userData.completedToday.push(id);
                    userData.points += 10;
                    userData.totalPoints = (userData.totalPoints || 0) + 10; // ì´ ëˆ„ì  í¬ì¸íŠ¸ ì¦ê°€
                    parent.classList.add('completed');
                }
            } else {
                userData.completedToday = userData.completedToday.filter(item => item !== id);
                userData.points -= 10;
                parent.classList.remove('completed');
            }
            
            // í˜„ì¬ ë‚ ì§œë¥¼ lastCheckì— ì„¤ì •í•˜ì—¬ í•˜ë£¨ ì¤‘ì— ì²´í¬ ìƒíƒœ ìœ ì§€
            userData.lastCheck = new Date().toDateString();
            
            // ë°ì´í„° ì €ì¥ ë° ë°±ì—…
            saveUserData();
            updateProgress();
            updateBadges();

            // ì˜¤ëŠ˜ íšë“ í¬ì¸íŠ¸ ì—…ë°ì´íŠ¸
            updateDailyPoints();

            // ë ˆë²¨ì—… ì²´í¬
            if(userData.points >= userData.level * 100) {
                userData.level++;
                alert(`ğŸ‰ ë ˆë²¨ì—…! í‰ì˜¨ ë ˆë²¨ ${userData.level} ë‹¬ì„±!`);
                saveUserData();
                updateLevelProgress();
            } else {
                updateLevelProgress();
            }
        }
        
        // ì‚¬ìš©ì ë°ì´í„° ì €ì¥ ë° ë°±ì—…
        function saveUserData() {
            localStorage.setItem('emotionalIndependence', JSON.stringify(userData));
            
            // ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì—ë„ ë°±ì—… (ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ê°€ í´ë¦¬ì–´ë˜ëŠ” ê²½ìš° ëŒ€ë¹„)
            try {
                sessionStorage.setItem('emotionalIndependence_backup', JSON.stringify(userData));
            } catch (e) {
                console.log('ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ ë°±ì—… ì‹¤íŒ¨:', e);
            }
        }
        
        // ë°ì´í„° ë³µêµ¬ í•¨ìˆ˜
        function recoverUserData() {
            try {
                const backup = sessionStorage.getItem('emotionalIndependence_backup');
                if (backup && !localStorage.getItem('emotionalIndependence')) {
                    localStorage.setItem('emotionalIndependence', backup);
                    return JSON.parse(backup);
                }
            } catch (e) {
                console.log('ë°ì´í„° ë³µêµ¬ ì‹¤íŒ¨:', e);
            }
            return null;
        }

        // ë ˆë²¨ ì§„í–‰ë„ ì—…ë°ì´íŠ¸
        function updateLevelProgress() {
            const pointsNeeded = userData.level * 100;
            const pointsRemaining = Math.max(0, pointsNeeded - userData.points);
            const progressPercentage = userData.points >= pointsNeeded ? 100 : (userData.points / pointsNeeded) * 100;

            document.getElementById('levelProgress').textContent = `ë‹¤ìŒ ë ˆë²¨ê¹Œì§€: ${pointsRemaining}í¬ì¸íŠ¸`;
        }

        // ì˜¤ëŠ˜ íšë“ í¬ì¸íŠ¸ ì—…ë°ì´íŠ¸
        function updateDailyPoints() {
            const dailyPoints = userData.completedToday.length * 10;
            document.getElementById('dailyPoints').textContent = dailyPoints;
        }

        // ì—°ì† ì¼ìˆ˜ ê³„ì‚° ë° ì—…ë°ì´íŠ¸
        function updateStreak() {
            const today = new Date().toDateString();
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayString = yesterday.toDateString();

            const completed = userData.completedToday.length;

            // ì˜¤ëŠ˜ ì²« ë²ˆì§¸ ì²´í¬ì´ê³  ì–´ì œë„ ì²´í¬í•œ ê²½ìš° ì—°ì† ì¼ìˆ˜ ì¦ê°€
            if(completed > 0 && userData.lastCheck === yesterdayString) {
                userData.streak++;
                userData.lastCheck = today;
            }
            // ì–´ì œ ì²´í¬í•˜ì§€ ì•Šì•˜ëŠ”ë° ì˜¤ëŠ˜ ì²´í¬í•œ ê²½ìš° ì—°ì† ì¼ìˆ˜ 1ë¡œ ì„¤ì •
            else if(completed > 0 && !userData.lastCheck) {
                userData.streak = 1;
                userData.lastCheck = today;
            }
            // ì–´ì œ ì²´í¬í–ˆëŠ”ë° ì˜¤ëŠ˜ ì•„ì§ ì²´í¬í•˜ì§€ ì•Šì€ ê²½ìš°
            else if(completed === 0 && userData.lastCheck === yesterdayString) {
                // ì•„ì§ ì•„ë¬´ê²ƒë„ ì²´í¬í•˜ì§€ ì•Šì€ ê²ƒì´ë¯€ë¡œ ì—°ì† ì¼ìˆ˜ ìœ ì§€
            }
            // ì–´ì œ ì²´í¬í–ˆëŠ”ë° ì˜¤ëŠ˜ ì¼ë¶€ë§Œ ì²´í¬í•œ ê²½ìš°
            else if(completed > 0 && userData.lastCheck === today) {
                // ì´ë¯¸ ì—°ì† ì¼ìˆ˜ê°€ ì¦ê°€í–ˆìœ¼ë¯€ë¡œ ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ
            }
        }

        // ì§„í–‰ë„ ì—…ë°ì´íŠ¸
        function updateProgress() {
            const total = document.querySelectorAll('.check-input').length;
            const completed = userData.completedToday.length;
            const percentage = (completed / total) * 100;
            document.getElementById('dailyProgress').style.width = percentage + '%';

            // ì—°ì† ì¼ìˆ˜ ì—…ë°ì´íŠ¸
            updateStreak();
        }

        // ë±ƒì§€ ì—…ë°ì´íŠ¸
        function updateBadges() {
            const badgesContainer = document.getElementById('badges');
            badgesContainer.innerHTML = '';
            
            if(userData.streak >= 3) {
                badgesContainer.innerHTML += '<span class="badge">ğŸ”¥ 3ì¼ ì—°ì†</span>';
            }
            if(userData.streak >= 7) {
                badgesContainer.innerHTML += '<span class="badge">â­ í‰ì˜¨ ìˆ˜í˜¸ì</span>';
            }
            if(userData.level >= 3) {
                badgesContainer.innerHTML += '<span class="badge">ğŸ›¡ï¸ ì •ì‹ ì˜ ë°©íŒ¨</span>';
            }
            
            // ë³´ìƒ ë©”ì‹œì§€
            const total = document.querySelectorAll('.check-input').length;
            const completed = userData.completedToday.length;
            if(completed === total) {
                document.getElementById('rewardText').innerHTML = 
                    `ğŸ‰ ì™„ë£Œ! ì˜¤ëŠ˜ì˜ ë³´ìƒ: <strong>${getRandomReward()}</strong>`;
            }
        }

        // ëœë¤ ë³´ìƒ
        function getRandomReward() {
            const rewards = [
                "ë”°ëœ»í•œ ì°¨ í•œì”ì˜ ì—¬ìœ ",
                "ì¢‹ì•„í•˜ëŠ” ë…¸ë˜ 3ê³¡ ë“£ê¸°",
                "15ë¶„ ì¶”ê°€ íœ´ì‹",
                "ì‘ì€ ê°„ì‹ ë¨¹ê¸°",
                "ì˜¤ëŠ˜ì€ ì¹­ì°¬ ì¼ê¸° ì“°ì§€ ì•Šê¸°"
            ];
            return rewards[Math.floor(Math.random() * rewards.length)];
        }

        // í˜¸í¡ë²• íƒ€ì´ë¨¸
        function startBreathing() {
            alert("ğŸŒ¬ï¸ 4ì´ˆ ë“¤ì´ë§ˆì‹œê¸° â†’ 7ì´ˆ ì°¸ê¸° â†’ 8ì´ˆ ë‚´ì‰¬ê¸°\n\nì§€ê¸ˆ ì‹œì‘í•©ë‹ˆë‹¤. í™”ë©´ì„ ë³´ë©° ë”°ë¼í•´ì£¼ì„¸ìš”!");
            
            let step = 0;
            const steps = [
                { text: "ë“¤ì´ë§ˆì‹œê¸° (4ì´ˆ)", duration: 4000 },
                { text: "ì°¸ê¸° (7ì´ˆ)", duration: 7000 },
                { text: "ë‚´ì‰¬ê¸° (8ì´ˆ)", duration: 8000 }
            ];
            
            const interval = setInterval(() => {
                alert(steps[step].text);
                step++;
                if(step >= steps.length) {
                    clearInterval(interval);
                    alert("âœ… í˜¸í¡ë²• ì™„ë£Œ! ì´ì œ ì¡°ê¸ˆ ë” í‰ì˜¨í•´ì§€ì…¨ë‚˜ìš”?");
                }
            }, steps[step]?.duration || 0);
        }

        // ê°ì • ì¼ê¸° ì €ì¥
        function saveDiary() {
            const wifeAction = document.getElementById('wifeAction').value;
            const myReaction = document.getElementById('myReaction').value;
            const reinterpretation = document.getElementById('reinterpretation').value;
            
            if(!wifeAction || !myReaction || !reinterpretation) {
                alert('ëª¨ë“  í•„ë“œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”!');
                return;
            }
            
            const diary = {
                date: new Date().toLocaleString(),
                wifeAction,
                myReaction,
                reinterpretation
            };
            
            diaries.unshift(diary);
            localStorage.setItem('emotionDiaries', JSON.stringify(diaries));
            
            // ì¼ê¸° ë°ì´í„° ë°±ì—…
            try {
                sessionStorage.setItem('emotionDiaries_backup', JSON.stringify(diaries));
            } catch (e) {
                console.log('ì¼ê¸° ë°±ì—… ì‹¤íŒ¨:', e);
            }
            
            // ì²´í¬ë°•ìŠ¤ ìë™ ì™„ë£Œ
            document.getElementById('evening2').checked = true;
            handleCheck({target: document.getElementById('evening2')});
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('wifeAction').value = '';
            document.getElementById('myReaction').value = '';
            document.getElementById('reinterpretation').value = '';
            
            displayDiaries();
            alert('âœ… ê°ì • ì¼ê¸°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // ì¼ê¸° ëª©ë¡ í‘œì‹œ
        function displayDiaries() {
            const diaryList = document.getElementById('diaryList');
            diaryList.innerHTML = '';
            
            if(diaries.length === 0) {
                diaryList.innerHTML = '<p style="color: #666;">ì €ì¥ëœ ì¼ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }
            
            diaries.slice(0, 7).forEach(diary => {
                const diaryItem = document.createElement('div');
                diaryItem.className = 'diary-item';
                diaryItem.innerHTML = `
                    <div style="font-size: 0.8rem; color: #666; margin-bottom: 5px;">ğŸ“… ${diary.date}</div>
                    <div><strong>ğŸ‘© ì•„ë‚´:</strong> ${diary.wifeAction}</div>
                    <div><strong>ğŸ‘¨ ë‚˜:</strong> ${diary.myReaction}</div>
                    <div><strong>ğŸ’¡ ì¬í•´ì„:</strong> <span style="color: var(--success);">${diary.reinterpretation}</span></div>
                `;
                diaryList.appendChild(diaryItem);
            });
        }

        // ì¼ê¸° ì‚­ì œ
        function clearDiaries() {
            if(confirm('ì •ë§ ëª¨ë“  ê°ì • ì¼ê¸°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                diaries = [];
                localStorage.setItem('emotionDiaries', JSON.stringify(diaries));
                displayDiaries();
                alert('ëª¨ë“  ì¼ê¸°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë‚ ì§œ ë³€ê²½ í™•ì¸ ë° completedToday ë°°ì—´ ì´ˆê¸°í™”
        function checkDateChangeAndReset() {
            const today = new Date().toDateString();
            const lastCheck = userData.lastCheck;
            
            if (lastCheck && lastCheck !== today) {
                // ë‚ ì§œê°€ ë³€ê²½ëœ ê²½ìš°
                const yesterday = new Date(lastCheck);
                const currentDate = new Date(today);
                const daysDiff = Math.floor((currentDate - yesterday) / (1000 * 60 * 60 * 24));
                
                if (daysDiff === 1) {
                    // í•˜ë£¨ê°€ ì§€ë‚œ ê²½ìš°: ì—°ì† ì¼ìˆ˜ëŠ” ìœ ì§€, completedTodayë§Œ ì´ˆê¸°í™”
                    console.log('ë‚ ì§œê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. completedToday ë°°ì—´ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.');
                } else if (daysDiff > 1) {
                    // ì—¬ëŸ¬ ë‚ ì´ ì§€ë‚œ ê²½ìš°: ì—°ì† ì¼ìˆ˜ë„ ì´ˆê¸°í™”
                    userData.streak = 0;
                    console.log('ì—¬ëŸ¬ ë‚ ì´ ì§€ë‚¬ìŠµë‹ˆë‹¤. ì—°ì† ì¼ìˆ˜ì™€ completedToday ë°°ì—´ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.');
                }
                
                // completedToday ë°°ì—´ ì´ˆê¸°í™”
                userData.completedToday = [];
                userData.points = 0; // ë§¤ì¼ í¬ì¸íŠ¸ë„ ì´ˆê¸°í™”
                
                // ë³€ê²½ëœ ë°ì´í„° ì €ì¥
                saveUserData();
                
                // UI ì—…ë°ì´íŠ¸
                updateUI();
                
                console.log('completedToday ë°°ì—´ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else if (!lastCheck && userData.completedToday.length > 0) {
                // lastCheckê°€ ì—†ì§€ë§Œ completedTodayì— ë°ì´í„°ê°€ ìˆëŠ” ê²½ìš°
                // ì˜¤ëŠ˜ ë‚ ì§œë¡œ lastCheck ì„¤ì •í•˜ì—¬ ë°ì´í„° ìœ ì§€
                userData.lastCheck = today;
                saveUserData();
                console.log('lastCheckë¥¼ ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì„¤ì •í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // ë°ì´í„° ë³µêµ¬ ì‹œë„
            const recoveredData = recoverUserData();
            if (recoveredData) {
                userData = recoveredData;
                console.log('ë°ì´í„°ê°€ ë³µêµ¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
            
            // ì¼ê¸° ë°ì´í„° ë³µêµ¬ ì‹œë„
            try {
                const diaryBackup = sessionStorage.getItem('emotionDiaries_backup');
                if (diaryBackup && diaries.length === 0) {
                    diaries = JSON.parse(diaryBackup);
                    console.log('ì¼ê¸° ë°ì´í„°ê°€ ë³µêµ¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            } catch (e) {
                console.log('ì¼ê¸° ë°ì´í„° ë³µêµ¬ ì‹¤íŒ¨:', e);
            }
            
            // ë‚ ì§œ ë³€ê²½ í™•ì¸ ë° ì´ˆê¸°í™”
            checkDateChangeAndReset();
            
            updateUI();
        });
    </script>
</body>
</html>